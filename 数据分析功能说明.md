# 智慧社区数据分析功能说明文档

## 📊 功能概述

本功能为智慧社区系统新增了完整的数据分析模块，包含数据分析和服务统计两大核心功能，支持多维度数据统计、可视化展示和智能洞察。

## 🚀 主要功能

### 1. 数据分析
- **保修类型分布统计**: 分析不同保修类型的工单数量、占比、处理时长和满意度
- **服务响应时长分析**: 统计服务响应时间趋势，找出效率瓶颈
- **居民活跃度统计**: 跟踪用户活跃度、新增用户、留存率等关键指标

### 2. 服务统计
- **按月/季统计服务完成量**: 支持日、周、月、季度、年度多种统计维度
- **满意度评分分析**: 分析不同服务类型的用户满意度和评分趋势
- **历史数据对比**: 支持同比、环比数据对比分析

### 3. 数据可视化
- **多种图表类型**: 饼图、柱状图、折线图、面积图等
- **交互式图表**: 基于ECharts的高质量可视化组件
- **响应式设计**: 适配移动端和桌面端

### 4. 数据导出
- **图表导出**: 支持PNG格式图表导出
- **数据导出**: 支持CSV格式数据导出
- **报告生成**: 自动生成数据分析报告

## 📱 前端界面

### 1. 数据分析主页 (`AnalyticsHomeView.vue`)
- **概览卡片**: 显示关键指标概览
- **时间选择器**: 支持自定义时间范围
- **功能菜单**: 快速访问各种分析功能
- **快速预览**: 重要图表的快速预览

### 2. 详细分析页 (`AnalyticsDetailView.vue`)
- **交互式图表**: 大尺寸详细图表展示
- **数据表格**: 详细数据列表展示
- **数据洞察**: AI智能分析结果
- **导出功能**: 图表和数据导出

### 3. 路由配置
```
/analytics - 数据分析首页
/analytics/detail/:type - 详细分析页面
```

## 🛠 后端架构

### 1. 实体类 (Entity)
- `DataAnalyticsSummary`: 数据分析汇总表
- `RepairTypeStatistics`: 保修类型统计表  
- `ServiceStatistics`: 服务统计表
- `UserActivityStatistics`: 用户活跃度统计表

### 2. 数据传输对象 (DTO)
- `AnalyticsQueryDTO`: 查询条件DTO
- `RepairTypeDistributionDTO`: 保修类型分布DTO
- `ServiceResponseTimeDTO`: 服务响应时长DTO
- `UserActivityDTO`: 用户活跃度DTO
- `ServiceStatisticsDTO`: 服务统计DTO
- `AnalyticsReportDTO`: 分析报告DTO

### 3. 服务层 (Service)
- `DataAnalyticsService`: 数据分析服务接口
- `DataAnalyticsServiceImpl`: 数据分析服务实现

### 4. 控制器 (Controller)
- `DataAnalyticsController`: 数据分析API控制器

### 5. 数据访问层 (Mapper)
- `AnalyticsMapper`: 复杂查询映射器
- `DataAnalyticsSummaryMapper`: 汇总数据映射器
- `RepairTypeStatisticsMapper`: 保修统计映射器
- `ServiceStatisticsMapper`: 服务统计映射器
- `UserActivityStatisticsMapper`: 用户活跃度映射器

## 🗄️ 数据库设计

### 新增数据表

1. **data_analytics_summary** - 数据分析汇总表
   - 存储各种统计数据的汇总信息
   - 支持不同统计类型（日/周/月/季/年）

2. **repair_type_statistics** - 保修类型统计表
   - 记录各保修类型的详细统计数据
   - 包含工单数量、完成率、处理时长等指标

3. **service_statistics** - 服务统计表
   - 存储各服务类型的统计信息
   - 包含订单量、完成率、营收、评分等数据

4. **user_activity_statistics** - 用户活跃度统计表
   - 记录用户活跃度相关指标
   - 支持DAU、WAU、MAU统计

5. **analytics_tasks** - 数据分析任务表
   - 管理定时统计任务
   - 支持任务状态跟踪

6. **analytics_reports** - 数据分析报告表
   - 存储生成的分析报告
   - 支持不同报告类型

### 索引优化
- 为关键字段添加索引以提升查询性能
- 针对时间范围查询进行优化

## 🔌 API接口

### 基础路径: `/api/analytics`

1. **GET** `/repair-type-distribution` - 获取保修类型分布统计
2. **GET** `/service-response-time` - 获取服务响应时长统计
3. **GET** `/user-activity` - 获取用户活跃度统计
4. **GET** `/service-completion` - 获取服务完成量统计
5. **GET** `/satisfaction-score` - 获取满意度评分统计
6. **GET** `/historical-comparison` - 获取历史对比数据
7. **POST** `/report` - 生成数据分析报告

### 参数说明
- `startDate`: 开始日期 (yyyy-MM-dd)
- `endDate`: 结束日期 (yyyy-MM-dd)
- `statisticsType`: 统计类型 (1-日 2-周 3-月 4-季度 5-年)
- `serviceType`: 服务类型 (可选)

## 📋 部署步骤

### 1. 数据库部署
```sql
-- 执行数据库脚本
source database_analytics_tables.sql;
```

### 2. 后端部署
```bash
# 已自动包含在现有项目中，无需额外操作
# 实体类、服务层、控制器已创建完成
```

### 3. 前端部署
```bash
# 进入前端目录
cd ai-community-frontend/user

# 安装ECharts依赖
npm install echarts@^5.4.3

# 启动开发服务器
npm run dev
```

## 🎯 功能特色

### 1. 智能洞察
- 自动分析数据趋势
- 生成关键指标洞察
- 提供优化建议

### 2. 多维度分析
- 支持多种统计维度
- 灵活的时间范围选择
- 丰富的筛选条件

### 3. 实时响应
- 实时数据更新
- 快速查询响应
- 优化的数据库查询

### 4. 用户体验
- 直观的图表展示
- 流畅的交互体验
- 移动端适配优化

## 🔧 技术栈

### 后端
- **框架**: Spring Boot
- **ORM**: MyBatis Plus
- **数据库**: MySQL 8.0
- **API文档**: 无需Swagger（已移除依赖）

### 前端
- **框架**: Vue 3 + TypeScript
- **UI组件**: Vant 4
- **图表库**: ECharts 5
- **构建工具**: Vite
- **路由**: Vue Router 4

## 📈 性能优化

### 1. 数据库优化
- 合理的索引设计
- 查询语句优化
- 分页查询支持

### 2. 前端优化
- 组件懒加载
- 图表按需渲染
- 数据缓存机制

### 3. 接口优化
- 并行数据加载
- 错误处理优化
- 响应数据压缩

## 🚧 扩展建议

### 1. 定时任务
- 实现数据统计定时任务
- 支持历史数据预统计
- 定期数据清理机制

### 2. 权限控制
- 管理员数据分析权限
- 部门级数据访问控制
- 数据脱敏处理

### 3. 高级功能
- 数据预测分析
- 异常检测告警
- 自定义报表生成

## 📞 技术支持

如有问题，请检查：
1. 数据库表是否正确创建
2. 前端依赖是否正确安装
3. API接口是否正常访问
4. 数据权限是否配置正确

---

**注意**: 本功能完全独立，不会影响现有系统功能的正常运行。
