# 预约服务测试数据生成器使用说明

## 📝 概述

`AppointmentTestDataGenerator` 是专为预约服务模块设计的测试数据生成器，能够快速生成完整的测试数据，包括用户、服务类型、服务人员和预约订单等。

## 🗃️ 数据库表结构

基于以下实体类生成测试数据：

### 1. 用户表 (users)
```sql
-- 用户基础信息表
- id: 用户ID (自增主键)
- username: 用户名 (登录用)
- password: 加密密码
- phone: 手机号
- nickname: 昵称
- gender: 性别 (0-未知 1-男 2-女)
- status: 状态 (0-禁用 1-正常 2-未激活)
- register_time: 注册时间
```

### 2. 服务类型表 (appointment_services)
```sql
-- 预约服务类型表
- id: 服务ID (自增主键)
- service_type: 服务类型标识 (cleaning/repair/moving等)
- service_name: 服务名称
- description: 服务描述
- icon: 服务图标
- base_price: 基础价格
- unit: 计价单位
- is_hot: 是否热门服务 (0-否 1-是)
- sort_order: 排序权重
- status: 状态 (0-禁用 1-启用)
```

### 3. 服务人员表 (appointment_workers)
```sql
-- 预约服务人员表
- id: 服务人员ID (自增主键)
- worker_name: 服务人员姓名
- worker_phone: 联系电话
- gender: 性别 (0-未知 1-男 2-女)
- age: 年龄
- experience_years: 工作经验年数
- service_types: 服务类型 (多个用逗号分隔)
- skill_description: 技能描述
- rating: 评分 (1-5分)
- order_count: 接单数量
- status: 状态 (0-离职 1-在职 2-休假)
```

### 4. 预约订单表 (appointment_orders)
```sql
-- 预约订单表
- id: 预约订单ID (自增主键)
- order_no: 订单编号
- user_id: 用户ID
- service_id: 服务ID
- service_type: 服务类型
- service_name: 服务名称
- worker_id: 服务人员ID
- worker_name: 服务人员姓名
- appointment_time: 预约服务时间
- address: 服务地址
- contact_name: 联系人姓名
- contact_phone: 联系电话
- estimated_price: 预估价格
- actual_price: 实际价格
- status: 订单状态 (0-待确认 1-已确认 2-服务中 3-已完成 4-已取消)
- rating: 用户评分 (1-5分)
- comment: 用户评价
```

## 🚀 使用方法

### 方法1: 生成所有测试数据
```java
@Test
public void generateAllTestData()
```
**功能**: 一键生成所有模块的测试数据
**生成内容**:
- 10个测试用户
- 10种服务类型
- 20个服务人员  
- 50个预约订单

### 方法2: 分模块生成

#### 生成测试用户
```java
@Test
public void generateTestUsers()
```
**生成数据**:
- 用户名: test_user01~05, zhang_san, li_si等
- 昵称: 小明, 小红, 阳光少年等
- 手机号: 138****8888 格式
- 随机性别和认证状态

#### 生成服务类型
```java
@Test  
public void generateServiceTypes()
```
**生成数据**:
- 家政保洁 (cleaning) - 热门服务
- 维修服务 (repair) - 热门服务
- 家电维修 (appliance)
- 搬家服务 (moving) - 热门服务
- 园艺服务 (gardening)
- 除虫服务 (pest)
- 家教服务 (tutoring) - 热门服务
- 养老护理 (eldercare)
- 育儿服务 (childcare) - 热门服务
- 厨师服务 (cooking)

#### 生成服务人员
```java
@Test
public void generateServiceWorkers()
```
**生成数据**:
- 按服务类型分配专业人员
- 真实的姓名和联系方式
- 详细的技能描述
- 合理的评分和接单数量
- 匹配的工作经验

#### 生成预约订单
```java
@Test
public void generateAppointmentOrders()
```
**生成数据**:
- 50个预约订单
- 随机分配用户、服务和服务人员
- 未来7-30天的预约时间
- 多种订单状态分布
- 真实的地址和联系信息
- 合理的价格范围

### 方法3: 清理测试数据
```java
@Test
public void clearAllTestData()
```
**功能**: 清理所有测试数据，恢复空表状态

## 📊 生成的测试数据详情

### 🧑‍🤝‍🧑 测试用户 (10个)
| 用户名 | 昵称 | 手机号 | 性别 |
|--------|------|--------|------|
| test_user01 | 小明 | 138****5678 | 随机 |
| zhang_san | 阳光少年 | 139****6789 | 随机 |
| ... | ... | ... | ... |

### 🛠️ 服务类型 (10种)
| 服务类型 | 服务名称 | 基础价格 | 是否热门 |
|----------|----------|----------|----------|
| cleaning | 家政保洁 | ¥80.00 | ✅ |
| repair | 维修服务 | ¥50.00 | ✅ |
| moving | 搬家服务 | ¥200.00 | ✅ |
| tutoring | 家教服务 | ¥150.00/小时 | ✅ |
| ... | ... | ... | ... |

### 👷 服务人员 (20个)
| 姓名 | 服务类型 | 评分 | 接单数 | 经验年数 |
|------|----------|------|--------|----------|
| 李阿姨 | cleaning | 4.8⭐ | 156单 | 8年 |
| 刘师傅 | repair,appliance | 4.9⭐ | 285单 | 12年 |
| 林老师 | tutoring | 4.9⭐ | 245单 | 5年 |
| ... | ... | ... | ... | ... |

### 📋 预约订单 (50个)
| 订单编号 | 服务类型 | 状态 | 预约时间 | 价格 |
|----------|----------|------|----------|------|
| APT202501220001 | 家政保洁 | 待确认 | 2025-01-29 09:00 | ¥75.50 |
| APT202501220002 | 维修服务 | 已确认 | 2025-02-05 14:30 | ¥48.90 |
| ... | ... | ... | ... | ... |

## ⚙️ 运行步骤

### 1. 环境准备
```bash
# 确保数据库已创建并运行了数据库初始化脚本
mysql -u root -p ai_community < src/main/resources/db/init.sql
mysql -u root -p ai_community < src/main/resources/db/appointment_tables.sql
```

### 2. 配置测试环境
```yaml
# application-test.yml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/ai_community_test
    username: your_username  
    password: your_password
  profiles:
    active: test
```

### 3. 运行测试
```bash
# 方式1: 使用IDE运行测试方法
右键点击 AppointmentTestDataGenerator 类 -> Run

# 方式2: 使用Maven命令
mvn test -Dtest=AppointmentTestDataGenerator#generateAllTestData

# 方式3: 运行特定测试方法
mvn test -Dtest=AppointmentTestDataGenerator#generateServiceTypes
```

## 🎯 数据特点

### ✅ 数据完整性
- 所有必填字段都有值
- 外键关联正确
- 数据格式符合业务规则

### ✅ 数据真实性
- 真实的中文姓名
- 合理的价格范围
- 符合逻辑的时间分布
- 真实的地址信息

### ✅ 数据多样性
- 多种服务类型覆盖
- 不同状态的订单分布
- 各种评分和评价内容
- 丰富的用户画像

### ✅ 业务逻辑
- 服务人员与服务类型匹配
- 订单状态逻辑合理
- 价格波动在合理范围
- 评分评价符合完成订单

## 🔧 自定义配置

### 修改数据量
```java
// 在对应方法中修改循环次数
for (int i = 0; i < 50; i++) { // 改为需要的数量
    // 生成订单逻辑
}
```

### 添加新的服务类型
```java
Object[][] serviceData = {
    // 现有数据...
    {"new_service", "新服务名称", "服务描述", "icon", new BigDecimal("100.00"), "次", 0, 11}
};
```

### 自定义地址池
```java
String[] addresses = {
    "你的自定义地址1",
    "你的自定义地址2",
    // 更多地址...
};
```

## ⚠️ 注意事项

1. **测试环境**: 建议在测试数据库中运行，避免污染生产数据
2. **数据清理**: 使用 `clearAllTestData()` 方法清理测试数据
3. **依赖关系**: 生成订单前确保已有用户、服务类型和服务人员数据
4. **重复运行**: 用户名唯一，重复运行会跳过已存在的用户
5. **性能考虑**: 大量数据生成时可能需要较长时间

## 🔍 验证数据

生成完成后，可以通过以下SQL验证数据：

```sql
-- 检查各表数据量
SELECT 'users' as table_name, COUNT(*) as count FROM users
UNION ALL
SELECT 'appointment_services', COUNT(*) FROM appointment_services  
UNION ALL
SELECT 'appointment_workers', COUNT(*) FROM appointment_workers
UNION ALL  
SELECT 'appointment_orders', COUNT(*) FROM appointment_orders;

-- 检查订单状态分布
SELECT status, COUNT(*) as count, 
       CASE status 
           WHEN 0 THEN '待确认'
           WHEN 1 THEN '已确认' 
           WHEN 2 THEN '服务中'
           WHEN 3 THEN '已完成'
           WHEN 4 THEN '已取消'
       END as status_name
FROM appointment_orders 
GROUP BY status;

-- 检查服务类型分布
SELECT service_type, service_name, COUNT(*) as order_count
FROM appointment_orders 
GROUP BY service_type, service_name
ORDER BY order_count DESC;
```

---

🎉 **使用这个测试数据生成器，您可以快速为预约服务模块生成完整、真实、多样的测试数据，便于进行功能测试和演示！**

