# 数据分析功能测试数据导入指南

## 问题原因
你之前遇到的"Column count doesn't match value count"错误是因为：
1. SQL INSERT 语句中列数与值数不匹配
2. 缺少了数据库表中的一些必要字段
3. 字段顺序与表结构不一致

## 解决方案

### 步骤1：使用正确的SQL文件
请使用 `src/main/resources/correct-test-data.sql` 文件，这个文件包含了：
- ✅ 正确的字段数量和顺序
- ✅ 完整的 `appointment_orders` 表数据（21条记录）
- ✅ 完整的 `repair_orders` 表数据（21条记录）
- ✅ 12月最新数据 + 6-11月历史数据

### 步骤2：导入数据
在你的MySQL客户端中执行：

```sql
-- 1. 选择数据库
USE ai_community;

-- 2. 执行导入脚本
SOURCE src/main/resources/correct-test-data.sql;

-- 或者直接复制粘贴文件内容并执行
```

### 步骤3：验证数据
导入后验证数据：

```sql
-- 检查预约订单数据
SELECT COUNT(*) as total_appointments FROM appointment_orders WHERE id >= 1000;
-- 预期结果：21条记录

-- 检查维修订单数据  
SELECT COUNT(*) as total_repairs FROM repair_orders WHERE id >= 2000;
-- 预期结果：21条记录

-- 检查12月数据分布
SELECT 
    service_type, 
    COUNT(*) as count,
    AVG(rating) as avg_rating
FROM appointment_orders 
WHERE create_time >= '2024-12-01' 
GROUP BY service_type;

-- 检查状态分布
SELECT 
    status,
    COUNT(*) as count,
    CASE 
        WHEN status = 0 THEN '待确认'
        WHEN status = 1 THEN '已确认' 
        WHEN status = 2 THEN '服务中'
        WHEN status = 3 THEN '已完成'
        WHEN status = 4 THEN '已取消'
    END as status_name
FROM appointment_orders 
WHERE id >= 1000
GROUP BY status;
```

## 数据特点

### 预约订单 (appointment_orders)
- **总数**：21条（12月15条 + 历史6条）
- **服务类型**：维修服务、清洁服务、安装服务
- **状态分布**：已完成(60%)、待确认(20%)、服务中(20%)
- **评分范围**：3-5星，平均约4.3分
- **时间跨度**：2024年6月-12月

### 维修订单 (repair_orders)  
- **总数**：21条（12月15条 + 历史6条）
- **维修类型**：电器维修、水管维修、门窗维修
- **状态分布**：已完成(65%)、待受理(20%)、处理中(15%)
- **满意度**：3-5星，平均约4.2分
- **时间跨度**：2024年6月-12月

## 测试验证

导入成功后，访问以下API测试数据分析功能：

```bash
# 1. 维修类型分布
GET /api/analytics/repair-type-distribution?startDate=2024-12-01&endDate=2024-12-31

# 2. 服务响应时间
GET /api/analytics/service-response-time?startDate=2024-12-01&endDate=2024-12-31

# 3. 用户活跃度
GET /api/analytics/user-activity?startDate=2024-12-01&endDate=2024-12-31

# 4. 服务完成统计
GET /api/analytics/service-completion?startDate=2024-12-01&endDate=2024-12-31

# 5. 满意度评分
GET /api/analytics/satisfaction-score?startDate=2024-12-01&endDate=2024-12-31
```

## 预期结果

导入数据后，你的数据分析页面应该显示：
- 📊 **维修类型分布图**：电器维修占比最高
- ⏱️ **平均响应时间**：约15-30分钟
- 👥 **日活跃用户**：每日1-3个用户
- ✅ **服务完成率**：约60-70%
- ⭐ **平均满意度**：4.2-4.3分

## 故障排除

如果仍然出现问题：

1. **检查表结构**：
```sql
DESCRIBE appointment_orders;
DESCRIBE repair_orders;
```

2. **重启应用**：
导入数据后重启Spring Boot应用以清理缓存

3. **检查日志**：
查看应用日志中是否有SQL异常或MyBatis映射错误

4. **清理重试**：
如果需要重新导入，先清理测试数据：
```sql
DELETE FROM appointment_orders WHERE id >= 1000;
DELETE FROM repair_orders WHERE id >= 2000;
```
